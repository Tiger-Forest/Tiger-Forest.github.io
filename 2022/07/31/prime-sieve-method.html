<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><script type=text/javascript src=js/lib/love.js></script><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color content=#fff id=theme-color><meta name=description content=一个网站><link rel=icon href="https://static.wenshushu.cn/uf/8wzp9st1fij/img?st=MXI0NTJhMmptZzcuUXdpQjQ%3D&amp;op=zmmw-1200"><title>质数筛法及其优化</title><meta property=og:title content=质数筛法及其优化><meta property=og:url content=https://tiger-forest.github.io/2022/07/31/prime-sieve-method.html><meta property=og:img content="https://static.wenshushu.cn/uf/8wzp7znraob/img?st=MXI0NTJhMmptZzcuUXdpQjQ%3D&amp;op=zmmw-1200"><meta property=og:img content=&lt;p&gt;&lt;strong&gt;埃氏筛法&lt;/strong&gt;是一种由希腊数学家埃拉托斯特尼所提出的一种筛选质数(又称作素数)的算法。&lt;br&gt;&lt;strong&gt;欧拉筛法&lt;/strong&gt;相比于埃氏筛法，其效率更高。&lt;br&gt;这里对二者进行思路分析与代码解释。&lt;/p&gt;><meta property=og:type content=article><meta property=og:article:published_time content=2022-07-31><meta property=og:article:modified_time content=2022-08-10><meta property=og:article:author content=TigerForest><meta property=og:article:tag content=语言><meta property=og:article:tag content=数学><meta property=og:article:tag content=算法><link rel=preload href=//at.alicdn.com/t/font_1946621_i1kgafibvw.css as=style><link rel=preload href=//at.alicdn.com/t/font_1952792_89b4ac4k4up.css as=style><link rel=preload href=/css/main.css as=style><link rel=modulepreload href=//instant.page/5.1.0><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=//at.alicdn.com/t/font_1946621_i1kgafibvw.css><link rel=stylesheet href=//at.alicdn.com/t/font_1952792_89b4ac4k4up.css><link rel=stylesheet href=/js/lib/lightbox/baguetteBox.min.css><script>function loadScript(e,t){var n=document.createElement("script");n.src=e,t&&(n.onload=t),n.async=!0,document.body.appendChild(n)}function loadCSS(e,t,n){var a=document.createElement("link");a.ref="stylesheet",a.href=e,a.dataset[t]=n,document.head.appendChild(a)}function changeCSS(e,t,n){var t=document.querySelector(t),a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("href",e),a.dataset.prism=n,document.head.replaceChild(a,t)}</script><script>function prismThemeChange(){"dark"===document.getElementById("theme-color").dataset.mode?document.querySelector("[data-prism]")?changeCSS("/js/lib/prism/prism-tomorrow.min.css","[data-prism]","prism-tomorrow"):loadCSS("/js/lib/prism/prism-tomorrow.min.css","prism","prism-tomorrow"):document.querySelector("[data-prism]")?changeCSS("/js/lib/prism/prism.min.css","[data-prism]","prism"):loadCSS("/js/lib/prism/prism.min.css","prism","prism")}prismThemeChange()</script><link rel=stylesheet href=/js/lib/prism/prism-line-numbers.min.css><script>var reverseDarkList={dark:"light",light:"dark"},themeColor={dark:"#1c1c1e",light:"#fff"},getCssMediaQuery=function(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},reverseDarkModeSetting=function(){var e=localStorage.getItem("user-color-scheme");if(reverseDarkList[e])e=reverseDarkList[e];else{if(null!==e)return;e=reverseDarkList[getCssMediaQuery()]}return localStorage.setItem("user-color-scheme",e),e}</script><script>var setDarkmode=function(e){e=e||localStorage.getItem("user-color-scheme");e===getCssMediaQuery()?(document.documentElement.removeAttribute("data-user-color-scheme"),localStorage.removeItem("user-color-scheme"),document.getElementById("theme-color").content=themeColor[e],document.getElementById("theme-color").dataset.mode=e):reverseDarkList[e]?(document.documentElement.setAttribute("data-user-color-scheme",e),document.getElementById("theme-color").content=themeColor[e],document.getElementById("theme-color").dataset.mode=e):(document.documentElement.removeAttribute("data-user-color-scheme"),localStorage.removeItem("user-color-scheme"),document.getElementById("theme-color").content=themeColor[getCssMediaQuery()],document.getElementById("theme-color").dataset.mode=getCssMediaQuery()),prismThemeChange()};setDarkmode()</script><link rel=preload href=/js/lib/lightbox/baguetteBox.min.js as=script><link rel=preload href=/js/lib/lightbox/baguetteBox.min.css as=style><link rel=preload href=/js/lib/lozad.min.js as=script><link rel=prefetch href=//cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-svg.js as=script><link rel=prefetch href=//cdn-city.livere.com/js/embed.dist.js as=script><meta name=generator content="Hexo 6.2.0"></head><body><div class=wrapper><nav class=navbar><div class=navbar-logo><a class=navbar-logo-main href=/ ><img class=navbar-logo-img width=32 height=32 src="https://static.wenshushu.cn/uf/8wzp9st1fij/img?st=MXI0NTJhMmptZzcuUXdpQjQ%3D&op=zmmw-1200" alt="blog logo"> <span class=navbar-logo-dsc>TigerForest's Home</span></a></div><div class=navbar-menu><a href=/ class=navbar-menu-item>首页 </a><a href=/archives class=navbar-menu-item>归档 </a><a href=/tags class=navbar-menu-item>标签 </a><a href=/categories class=navbar-menu-item>分类 </a><a href=/about class=navbar-menu-item>关于 </a><a href=/links class=navbar-menu-item>友链 </a><button class="navbar-menu-item darknavbar navbar-menu-btn" aria-label="Toggle dark mode" id=dark><i class="iconfont icon-weather"></i></button> <button class="navbar-menu-item searchnavbar navbar-menu-btn" aria-label="Toggle search" id=search><svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink aria-hidden=true role=img class="iconify iconify--ion" width=28 height=28 preserveAspectRatio="xMidYMid meet" viewBox="0 0 512 512"><path fill=none stroke=currentColor stroke-miterlimit=10 stroke-width=28 d="M256 80a176 176 0 1 0 176 176A176 176 0 0 0 256 80Z"></path><path fill=none stroke=currentColor stroke-miterlimit=10 stroke-width=28 d="M232 160a72 72 0 1 0 72 72a72 72 0 0 0-72-72Z"></path><path fill=none stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=28 d="M283.64 283.64L336 336"></path></svg></button></div></nav><div id=local-search style="display: none"><input class=navbar-menu-item id=search-input placeholder=请输入搜索内容...><div id=search-content></div></div><div class=section-wrap><div class=container><div class=columns><aside class=left-column><div class="card card-author"><img src="https://static.wenshushu.cn/uf/8wzp7znraob/img?st=MXI0NTJhMmptZzcuUXdpQjQ%3D&op=zmmw-1200" class=author-img width=88 height=88 alt="author avatar"><p class=author-name>TigerForest</p><p class=author-description>JUST FOR FUN.</p><div class=author-message><a class=author-posts-count href=/archives><span>7</span> <span>文章</span> </a><a class=author-categories-count href=/categories><span>4</span> <span>分类</span> </a><a class=author-tags-count href=/tags><span>6</span> <span>标签</span></a></div><div class=author-card-society><div class=author-card-society-icon><a target=_blank rel=noopener href=https://github.com/tiger-forest><i class="iconfont icon-github society-icon"></i></a></div><div class=author-card-society-icon><a href=huxiaoshanlin@protonmail.com><i class="iconfont icon-mail society-icon"></i></a></div></div></div><div class=sticky-tablet><article class="display-when-two-columns spacer"><div class="card card-content toc-card"><div class=toc-header><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E5%B7%B2%E7%9F%A5%E4%BA%8B%E5%AE%9E><span class=toc-text>已知事实</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95><span class=toc-text>埃氏筛法</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86><span class=toc-text>代码部分</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E8%A7%A3%E6%9E%90><span class=toc-text>思路解析</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96><span class=toc-text>代码优化</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%E6%8E%92%E9%99%A4%E9%83%A8%E5%88%86%E9%87%8D%E5%A4%8D><span class=toc-text>1.排除部分重复</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E7%AD%9B%E8%87%B3%E5%B9%B3%E6%96%B9%E6%A0%B9><span class=toc-text>2.筛至平方根</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E6%AC%A7%E6%8B%89%E7%AD%9B%E6%B3%95><span class=toc-text>欧拉筛法</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86-1><span class=toc-text>代码部分</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E8%A7%A3%E6%9E%90-1><span class=toc-text>思路解析</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#if-i-prime-j-0-break-%E7%9A%84%E8%A7%A3%E9%87%8A><span class=toc-text>if (i % prime[j] &#x3D;&#x3D; 0) break;的解释</span></a></li></ol></li></ol></li></ol></div></article><article class="card card-content categories-widget"><div class=categories-card><div class=categories-header><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div><div class=categories-list><a href=/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%AC%94%E8%AE%B0/ ><div class=categories-list-item>计算机笔记 <span class=categories-list-item-badge>3</span></div></a><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ ><div class=categories-list-item>学习笔记 <span class=categories-list-item-badge>2</span></div></a><a href=/categories/%E7%AE%97%E6%B3%95/ ><div class=categories-list-item>算法 <span class=categories-list-item-badge>1</span></div></a><a href=/categories/%E6%8A%98%E8%85%BE%E6%97%A5%E5%BF%97/ ><div class=categories-list-item>折腾日志 <span class=categories-list-item-badge>1</span></div></a></div></div></article><article class="card card-content tags-widget"><div class=tags-card><div class=tags-header><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div><div class=tags-list><a href=/tags/%E8%AF%AD%E8%A8%80/ title=语言><div class=tags-list-item>语言</div></a><a href=/tags/%E6%95%B0%E5%AD%A6/ title=数学><div class=tags-list-item>数学</div></a><a href=/tags/%E5%89%8D%E7%AB%AF/ title=前端><div class=tags-list-item>前端</div></a><a href=/tags/%E7%B3%BB%E7%BB%9F/ title=系统><div class=tags-list-item>系统</div></a><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/ title=计算机><div class=tags-list-item>计算机</div></a><a href=/tags/%E7%AE%97%E6%B3%95/ title=算法><div class=tags-list-item>算法</div></a></div></div></article></div></aside><main class=main-column><article class="card card-content"><header><h1 class=post-title>质数筛法及其优化</h1></header><div class="post-meta post-show-meta"><time datetime=2022-07-30T16:00:00.000Z><i class="iconfont icon-calendar" style="margin-right: 2px;"></i> <span>2022-07-31</span> </time><span class=dot></span> <a href=/categories/%E7%AE%97%E6%B3%95/ class=post-meta-link>算法 </a><span class=dot></span> <span>1.2k 字</span></div><div class="post-meta post-show-meta" style="margin-top: -10px;"><div style="display: flex; align-items: center;"><i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i> <a href=/tags/%E8%AF%AD%E8%A8%80/ class=post-meta-link>语言 </a><span class=dot></span> <a href=/tags/%E6%95%B0%E5%AD%A6/ class=post-meta-link>数学 </a><span class=dot></span> <a href=/tags/%E7%AE%97%E6%B3%95/ class=post-meta-link>算法</a></div></div><div id=section class=post-content><p><strong>埃氏筛法</strong>是一种由希腊数学家埃拉托斯特尼所提出的一种筛选质数(又称作素数)的算法。<br><strong>欧拉筛法</strong>相比于埃氏筛法，其效率更高。<br>这里对二者进行思路分析与代码解释。</p><span id=more></span><h1 id=已知事实><a href=#已知事实 class=headerlink title=已知事实></a>已知事实</h1><p>任何一个合数都能够分解成几个<strong>质数</strong>相乘的形式</p><h1 id=埃氏筛法><a href=#埃氏筛法 class=headerlink title=埃氏筛法></a>埃氏筛法</h1><h2 id=代码部分><a href=#代码部分 class=headerlink title=代码部分></a>代码部分</h2><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXN</span> <span class="token expression"><span class="token number">10005</span></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">bool</span> is_prime<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">//记录is_prime[i]是否为质数</span>
    <span class="token keyword">int</span> prime<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">,</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//prime为已记录的质数列表,cnt为已得到的质数个数</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>             <span class="token comment">//从区间(0,n]中筛选质数</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> is_prime<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//初始化全部质数，后面排除</span>
    is_prime<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    is_prime<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 0,1不是质数</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>is_prime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            cnt<span class="token operator">++</span><span class="token punctuation">;</span>          <span class="token comment">//质数个数+1</span>
            prime<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">//将质数加入数组prime</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">/*重点在这*/</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> j <span class="token operator">+=</span> i<span class="token punctuation">)</span> <span class="token comment">//将i的倍数(j)依次在数组中标记</span>
        <span class="token punctuation">&#123;</span>
            is_prime<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/*输出指定质数*/</span>
    <span class="token keyword">int</span> order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"No.%d==>%d\n"</span><span class="token punctuation">,</span> order<span class="token punctuation">,</span> prime<span class="token punctuation">[</span>order<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*输出所有质数*/</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> prime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id=思路解析><a href=#思路解析 class=headerlink title=思路解析></a>思路解析</h2><p>在埃氏筛法中，找到一个质数（从2开始），把这个质数的所有倍数标记出来<br>例：对于质数2，我们将二的倍数4,6,8,10……标记出来<br>相比于暴力筛选，这种方法时间复杂度可以降为O(n log log n)</p><h2 id=代码优化><a href=#代码优化 class=headerlink title=代码优化></a>代码优化</h2><h3 id=1-排除部分重复><a href=#1-排除部分重复 class=headerlink title=1.排除部分重复></a>1.排除部分重复</h3><p>在代码<code>for(int j=i*2;j&lt;=n;j+=i)</code>中，由于在前面的循环里从2*i到(i-1)*i已经计算过，所以我们可以直接使j从i*i开始循环<br><strong>具体解释：</strong></p><ul><li>j&#x3D;i<sub>当前</sub>*2时，i<sub>当前</sub>*2在前面已经计算出来过，具体在什么时候呢？在i<sub>过去</sub>&#x3D;2, j<sub>过去</sub>遍历到等于i<sub>当前</sub>的时候。*3，*4……以此类推，都已经在前面计算过。</li><li>直到j&#x3D;i<sub>当前</sub>*(i-1)时，i<sub>当前</sub>*(i-1)在前面已经计算出来过，具体在i<sub>过去</sub>&#x3D;(i-1), j<sub>过去</sub>遍历到等于i<sub>当前</sub>的时候。</li></ul><p><strong>优化片段</strong></p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">*</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> j <span class="token operator">+=</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    is_prime<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span></span></code></pre><h3 id=2-筛至平方根><a href=#2-筛至平方根 class=headerlink title=2.筛至平方根></a>2.筛至平方根</h3><p>要找到n之前的所有质数，我们筛选到 $\sqrt n$ 即可<br><strong>优化片段</strong></p><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">*</span>i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//此处i*i&lt;=n相当于i&lt;=sqrt(n)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is_prime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        cnt<span class="token operator">++</span><span class="token punctuation">;</span>          
        prime<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">*</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> j <span class="token operator">+=</span> i<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        is_prime<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id=欧拉筛法><a href=#欧拉筛法 class=headerlink title=欧拉筛法></a>欧拉筛法</h1><p>埃氏筛法即使进行优化，也会将一个合数标记多次，欧拉筛法提供了一个只需要将每个合数标记一次的思路<br>欧拉筛法又叫线性筛法，因为其时间复杂度是线性的，即O(n)</p><h2 id=代码部分-1><a href=#代码部分-1 class=headerlink title=代码部分></a>代码部分</h2><pre class="line-numbers language-cpp" data-language=cpp><code class=language-cpp><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXN</span> <span class="token expression"><span class="token number">10005</span></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">bool</span> is_prime<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">//记录is_prime[i]是否为质数</span>
    <span class="token keyword">int</span> prime<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">,</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//prime为已记录的质数列表,cnt为已得到的质数个数</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>             <span class="token comment">//从区间(0,n]中筛选质数</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>is_prime<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>is_prime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化全是质数，后面排除</span>
    is_prime<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    is_prime<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 0,1不是质数</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>is_prime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            cnt<span class="token operator">++</span><span class="token punctuation">;</span>          <span class="token comment">//质数个数+1</span>
            prime<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">//将质数加入数组prime</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/*将i与每个已得到的质数(prime[j])相乘得到的合数在数组中标明*/</span>
        <span class="token comment">/*如果i与某个已得到的质数乘积超过所求范围(n)，则结束*/</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> cnt <span class="token operator">&amp;&amp;</span> i <span class="token operator">*</span> prime<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            is_prime<span class="token punctuation">[</span>i <span class="token operator">*</span> prime<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> prime<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/*算法关键点，后面单独解释*/</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/*输出指定质数*/</span>
    <span class="token keyword">int</span> order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"No.%d==>%d\n"</span><span class="token punctuation">,</span> order<span class="token punctuation">,</span> prime<span class="token punctuation">[</span>order<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*输出所有质数*/</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> prime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id=思路解析-1><a href=#思路解析-1 class=headerlink title=思路解析></a>思路解析</h2><p>从1开始，将每一个数与已得到的质数相乘并作为合数标记在数组is_prime中</p><h3 id=if-i-prime-j-0-break-的解释><a href=#if-i-prime-j-0-break-的解释 class=headerlink title="if (i % prime[j] == 0) break;的解释"></a><code>if (i % prime[j] == 0) break;</code>的解释</h3><p>易知，当<code>i % prime[j] == 0</code>时，<code>prime[j]</code>是<code>i</code>的<strong>最小质因数</strong></p><p>此时若没有break，则后面j的循环里筛掉的一个数(设为x)有：<code>x = i * prime[k]</code>（这里k&gt;j）</p><p>因此x的因数中中必定含有素因数<code>prime[j]</code>，而除<code>prime[j]</code>之后得到的<code>x/prime[j]</code>必定大于<code>i</code>（∵<code>primes[k]/primes[j] &gt; 1</code>，∴<code>i*(primes[k]/primes[j]) &gt; i</code>）<br>所以这里的<code>x</code>会在后面的<code>i的循环</code>中被更大的<code>i</code>（即<code>x/prime[j]</code>）筛掉<br>所以当<code>i % prime[j] == 0</code>，要break，避免重复筛一个数。这也是它比埃氏筛法快的核心。</p></div><div><div class="post-note note-warning copyright" style="margin-top: 42px"><p><span style="font-weight: bold;">作者：</span><a target=_blank rel="nofollow noopener noreferrer" href=/about> TigerForest</a></p><p><span style="font-weight: bold;">文章链接：</span><a target=_blank rel="nofollow noopener noreferrer" href=https://tiger-forest.github.io/2022/07/31/prime-sieve-method.html> https://tiger-forest.github.io/2022/07/31/prime-sieve-method.html</a></p><p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target=_blank rel=noopener href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p></div></div></article><div class=nav><div class=nav-item-prev><a href=/2022/08/01/sine-cosine-law.html class=nav-link><i class="iconfont icon-left nav-prev-icon"></i><div><div class=nav-label>上一篇</div><div class=nav-title>【数学】正余弦定理的简单证明</div></div></a></div><div class=nav-item-next><a href=/2022/07/30/markdown-note.html class=nav-link><div><div class=nav-label>下一篇</div><div class=nav-title>Markdown学习笔记</div></div><i class="iconfont icon-right nav-next-icon"></i></a></div></div><div class="card card-content comment-card" style="margin-top: 16px;"><div class=comment-card-title>评论</div><div id=lv-container data-id=city data-uid="MTAyMC81NjkxNS8zMzM3OQ=="><script>!function(e,t){var r=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((e=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",e.defer=!0,r.parentNode.insertBefore(e,r))}(document,"script")</script></div></div><div class="card card-content toc-card" id=mobiletoc><div class=toc-header><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E5%B7%B2%E7%9F%A5%E4%BA%8B%E5%AE%9E><span class=toc-text>已知事实</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95><span class=toc-text>埃氏筛法</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86><span class=toc-text>代码部分</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E8%A7%A3%E6%9E%90><span class=toc-text>思路解析</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96><span class=toc-text>代码优化</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%E6%8E%92%E9%99%A4%E9%83%A8%E5%88%86%E9%87%8D%E5%A4%8D><span class=toc-text>1.排除部分重复</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E7%AD%9B%E8%87%B3%E5%B9%B3%E6%96%B9%E6%A0%B9><span class=toc-text>2.筛至平方根</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E6%AC%A7%E6%8B%89%E7%AD%9B%E6%B3%95><span class=toc-text>欧拉筛法</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86-1><span class=toc-text>代码部分</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E8%A7%A3%E6%9E%90-1><span class=toc-text>思路解析</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#if-i-prime-j-0-break-%E7%9A%84%E8%A7%A3%E9%87%8A><span class=toc-text>if (i % prime[j] &#x3D;&#x3D; 0) break;的解释</span></a></li></ol></li></ol></li></ol></div></main><aside class=right-column><div class=sticky-widescreen><article class="card card-content toc-card"><div class=toc-header><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E5%B7%B2%E7%9F%A5%E4%BA%8B%E5%AE%9E><span class=toc-text>已知事实</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E5%9F%83%E6%B0%8F%E7%AD%9B%E6%B3%95><span class=toc-text>埃氏筛法</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86><span class=toc-text>代码部分</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E8%A7%A3%E6%9E%90><span class=toc-text>思路解析</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96><span class=toc-text>代码优化</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%E6%8E%92%E9%99%A4%E9%83%A8%E5%88%86%E9%87%8D%E5%A4%8D><span class=toc-text>1.排除部分重复</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%E7%AD%9B%E8%87%B3%E5%B9%B3%E6%96%B9%E6%A0%B9><span class=toc-text>2.筛至平方根</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class=toc-link href=#%E6%AC%A7%E6%8B%89%E7%AD%9B%E6%B3%95><span class=toc-text>欧拉筛法</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86-1><span class=toc-text>代码部分</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E8%A7%A3%E6%9E%90-1><span class=toc-text>思路解析</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#if-i-prime-j-0-break-%E7%9A%84%E8%A7%A3%E9%87%8A><span class=toc-text>if (i % prime[j] &#x3D;&#x3D; 0) break;的解释</span></a></li></ol></li></ol></li></ol></article><article class="card card-content"><div class=recent-posts-card><div class=recent-posts-header><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div><div class=recent-posts-list><div class=recent-posts-item><div class=recent-posts-item-title>2022-08-10</div><a href=/2022/08/10/proof-quadratic-func-intercept-form.html><div class=recent-posts-item-content>【数学】二次函数交点式的证明</div></a></div><div class=recent-posts-item><div class=recent-posts-item-title>2022-08-01</div><a href=/2022/08/01/sine-cosine-law.html><div class=recent-posts-item-content>【数学】正余弦定理的简单证明</div></a></div><div class=recent-posts-item><div class=recent-posts-item-title>2022-07-31</div><a href=/2022/07/31/prime-sieve-method.html><div class=recent-posts-item-content>质数筛法及其优化</div></a></div><div class=recent-posts-item><div class=recent-posts-item-title>2022-07-30</div><a href=/2022/07/30/markdown-note.html><div class=recent-posts-item-content>Markdown学习笔记</div></a></div></div></div></article></div></aside></div></div></div></div><footer class=footer><div class=footer-container><div><div class=footer-dsc><span>Copyright © 2020 - 2022 </span>&nbsp; <a href=/ class=footer-link>TigerForest's Home</a></div></div><div class=footer-dsc>Powered by <a href=https://hexo.io/ class=footer-link target=_blank rel="nofollow noopener noreferrer">&nbsp;Hexo </a><span>&nbsp;|&nbsp;</span> Theme - <a href=https://github.com/theme-kaze class=footer-link target=_blank rel="nofollow noopener noreferrer">&nbsp;Kaze</a></div><div class=footer-dsc>本站总访问量<span id=busuanzi_value_site_pv></span>次 <span>&nbsp;|&nbsp;</span> 本站总访客数<span id=busuanzi_value_site_uv></span>次</div></div></footer><a role=button id=scrollbutton class=basebutton aria-label=回到顶部><i class="iconfont icon-arrowleft button-icon"></i> </a><a role=button id=menubutton aria-label="menu button" class=basebutton><i class="iconfont icon-menu button-icon"></i> </a><a role=button id=popbutton class=basebutton aria-label=控制中心><i class="iconfont icon-expand button-icon"></i> </a><a role=button id=darkbutton class="basebutton darkwidget" aria-label=夜色模式><i class="iconfont icon-weather button-icon"></i> </a><a role=button id=searchbutton class="basebutton searchwidget" aria-label=搜索><i class="iconfont icon-search button-icon"></i></a><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script src=//cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-svg.js></script><script>var addImgLayout=function(){for(var t=document.querySelectorAll(".post-content img"),e=0;e<t.length;e++){var a=document.createElement("a"),l=(a.setAttribute("href",t[e].getAttribute("data-src")),a.setAttribute("aria-label","illustration"),a.style.cssText="width: 100%; display: flex; justify-content: center;",t[e].alt&&(a.dataset.caption=t[e].alt),a.dataset.nolink=!0,t[e].before(a),a.append(t[e]),document.createElement("div"));l.classList.add("gallery"),a.before(l),l.append(a)}baguetteBox.run(".gallery")}</script><script>loadScript("/js/lib/lightbox/baguetteBox.min.js",addImgLayout)</script><script src=/js/main.js></script><script>loadScript("/js/lib/busuanzi.min.js")</script><script>var addLazyload=function(){lozad(".lozad",{load:function(a){a.srcset=a.getAttribute("data-src")},loaded:function(a){a.classList.add("loaded")}}).observe()}</script><script>loadScript("/js/lib/lozad.min.js",addLazyload)</script><script src=//instant.page/5.1.0 type=module integrity=sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw></script><script>setTimeout(()=>{localSearch("search.json")},0)</script><script src=/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/hijiki.model.json"},display:{superSample:2,weight:150,height:300,position:"right",hOffset:0,vOffset:-20},mobile:{show:!0,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2},log:!1})</script></body></html>